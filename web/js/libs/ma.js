// Generated by CoffeeScript 1.7.1
define(['jquery', 'api', 'utils'], function($, api, utils) {
  var awesomify, ma, mystify, prepare, test;
  test = function(data) {
    var entry, _i, _len, _results;
    _results = [];
    for (_i = 0, _len = data.length; _i < _len; _i++) {
      entry = data[_i];
      _results.push(console.log(entry.address_obj.address_string + ' ' + entry.latitude + ' ' + entry.longitude));
    }
    return _results;
  };
  prepare = function(attractions) {
    var attraction, result, _fn, _i, _len;
    result = {};
    _fn = function(a) {};
    for (_i = 0, _len = attractions.length; _i < _len; _i++) {
      attraction = attractions[_i];
      _fn(a);
    }
    return result;
  };
  awesomify = function(attractions, cb) {
    var input;
    console.log('attractions to deal with');
    input = prepare(attractions);
    return cb(null);
  };
  mystify = function(list, days, cb) {
    var attractions, end, key, keys, number, output, start, subcategories, todo, _fn, _i, _len;
    subcategories = 'landmarks';
    console.log('Something to mystify:');
    console.log(list);
    console.log(days);
    output = {};
    keys = utils.keys(list);
    number = keys.length;
    switch (number) {
      case 1:
        return;
      default:
        start = list[keys[0]];
        end = list[keys[1]];
        todo = 4;
        attractions = [];
        api.taIds({
          lat: start.lat,
          lng: start.lng
        }, function(result) {
          api.taLocation(result.city.id, {
            type: 'attractions',
            subcategory: subcategories
          }, function(result) {
            var item, _i, _len, _ref;
            _ref = result.data;
            for (_i = 0, _len = _ref.length; _i < _len; _i++) {
              item = _ref[_i];
              attractions.push(item);
            }
            todo--;
            if (todo === 0) {
              return awesomify(attractions, cb);
            }
          });
          return api.taLocation(result.country.id, {
            type: 'attractions',
            subcategory: subcategories
          }, function(result) {
            var item, _i, _len, _ref;
            _ref = result.data;
            for (_i = 0, _len = _ref.length; _i < _len; _i++) {
              item = _ref[_i];
              attractions.push(item);
            }
            todo--;
            if (todo === 0) {
              return awesomify(attractions, cb);
            }
          });
        });
        api.taIds({
          lat: end.lat,
          lng: end.lng
        }, function(result) {
          api.taLocation(result.city.id, {
            type: 'attractions',
            subcategory: subcategories
          }, function(result) {
            var item, _i, _len, _ref;
            _ref = result.data;
            for (_i = 0, _len = _ref.length; _i < _len; _i++) {
              item = _ref[_i];
              attractions.push(item);
            }
            todo--;
            if (todo === 0) {
              return awesomify(attractions, cb);
            }
          });
          return api.taLocation(result.country.id, {
            type: 'attractions',
            subcategory: subcategories
          }, function(result) {
            var item, _i, _len, _ref;
            _ref = result.data;
            for (_i = 0, _len = _ref.length; _i < _len; _i++) {
              item = _ref[_i];
              attractions.push(item);
            }
            todo--;
            if (todo === 0) {
              return awesomify(attractions, cb);
            }
          });
        });
    }
    _fn = function(key) {

      /*
      				item = list[key]
      				api.taMap
      					lat: item.lat
      					lng: item.lng
      				, 'attractions', (result) ->
      					console.log result
       */
    };
    for (_i = 0, _len = keys.length; _i < _len; _i++) {
      key = keys[_i];
      _fn(key);
    }
    return cb(output);
  };
  return ma = {
    attractions: {
      subcategories: {
        'Other': 'other',
        'Nightlife': 'nightlife',
        'Shopping': 'shopping',
        'Bar': 'bars',
        'Club': 'clubs',
        'Food & Drink': 'food_drink',
        'Ranch Farm': 'ranch_farm',
        'Adventure': 'adventure',
        'Gear Rental': 'gear_rentals',
        'Wellness & Spa': 'wellness_spas',
        'Class': 'classes',
        'Sightseeing Tour': 'sightseeing_tours',
        'Performance': 'performances',
        'Sport': 'sports',
        'Outdoor': 'outdoors',
        'Amusement': 'amusement',
        'Landmark': 'landmarks',
        'Zoo & Aquarium': 'zoos_aquariums',
        'Museums': 'museums',
        'Cultural': 'cultural'
      }
    },
    search: function(input, cb) {
      var city, inserted, list, _i, _len, _ref;
      list = {};
      inserted = [];
      _ref = input.cities;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        city = _ref[_i];
        if (inserted.indexOf(city) >= 0) {
          continue;
        }
        inserted.push(city);
        list[city] = {
          address: city
        };
      }
      return api.geoCode(list, function(result) {
        return mystify(result, input.days, function(result) {
          return cb(result);
        });
      });
    },
    mock: function() {
      var fake;
      fake = [
        {
          day: 1,
          city: {
            name: 'London',
            address: 'London, United Kingdom',
            photo: 'http://i.telegraph.co.uk/multimedia/archive/02423/london_2423609b.jpg'
          },
          attractions: [
            {
              name: 'London Eye',
              duration: 2,
              address: 'Riverside Bldg, County Hall Westminster Bridge Rd London SE1 7PB, United Kingdom',
              photo: 'http://cdn.londonandpartners.com/asset/20adda9d08e8480c6dbbfcf30fbcabdb.jpg'
            }, {
              name: 'The National Gallery',
              duration: 8,
              address: 'Trafalgar Square London WC2N 5DN United Kingdom',
              photo: 'http://ichef.bbci.co.uk/arts/yourpaintings/images/collections/main/NG_collection_image_1.jpg'
            }
          ]
        }
      ];
      return fake;
    }
  };
});
